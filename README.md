# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Интерфейс описывает данные корзины interface IBasket

```
quantity: number;
title: string;
price: number;
totalPrice: number;
```

Продукт interface ICardItem

```
id: string;
title: string;
category: string;
description: string;
image: string;
price: number | null;
inBasket: boolean;
button: string;
```

Интерфейс описывает приложение interface IProductItem

```
basket: IBasket[];
cardsList: ICardItem[];
preview: string | null;
order: IOrder | null;
image: string;
```

Данные формы заказа interface IOrder

```
payment: string;
address: string;
email: string;
phone: string;
total: number;
id: string[];
```

Тип ошибки заказа

```
type FormErrors = Partial<Record<keyof IOrder, string>>;
```

## Архитектура приложения

Код приложения разделен на слои, согласно MVP.

Структура проекта:

- интерфейс (вывод пользовательской информации);
- данные (лоигика приложения без интерфейса);
- Presenter (связывает данные с интерфейсом);

## Описание базовых классов

### Класс Api

Базовый класс отвечает за работу с серверными данными; хранит основные поля и методы;

Конструктор: (baseUrl: string; options: RequestInit = {}) хранит основные поля и методы, необходимые при работе с сервером

Методы:

- handleResponse - обрабатывает полученный ответ от сервера; возвращает ошибку если ответ отрицательный;
- post - принимает объект с данными, обрабатывает и отправляет их, как параметр при вызове метода;
- get - отправляет GET запрос с данными и возвращает ответ сервера;

### Класс Component

Абстрактный класс; создает компоненты пользовательского интерфейса;

Конструктор:

- (container: HTMLElement) контейнер, корневой DOM-элемент;

Методы:

- toggleClass - переключает класс;
- setText - устанавливает текстовое содержимое;
- hideElement - скрывает элемент;
- showElement - показывает элемент;
- setDisabled - изменяет состояние блокировки;
- render - возвращает DOM-элемент;
- setImage - устанавливает изображение с альтернативным текстом;

### Класс Model

Абстрактный класс, обощающий в себе конструктор и метод привязки события.

Конструктор: (data: Partial, protected events: IEvents) принимает данные модели и объект событий; копирует данные в модель;

Методы:

- emmitChanges — регистрирует входящее событие в EventEmitter;

### Класс EventEmitter

Базовая функциональность: реализует функционал обработчиков событий; позволяет отправлять события и подписываться на них;

Конструктор: constructor() создает карту событий;

Использует интерфейс IEvents;

Основные методы, реализуемые классом описаны интерфейсом IEvents:
Методы:

- on - устанавливает обработчик для указанного события;
- off - удаляет обработчик для указанного события;
- emit - вызывает событие с указанными данными;
- onAll - устанавливает обработчик для всех событий;
- offAll - удаляет все слушатели событий;
- trigger - создает слушатель событие с заданными аргументами;

## Описание классов данных

Данные классы принимают и хранят в себе данные об одном продукте: идентифекатор, заголовок, описание, категория, изображение, цену.

### Класс AppData

Главная модель управления проектом. Содержит в себе основные данные и методы для работы с моделью данных в целом. Наследуется от класса Model. использует интерфейс IProductItem

Поля класса:

- bascket - для данных корзины покупок;
- items - для данных списка товаров;
- order - для данных заказа, который отправляется на сервер;
- preview - для данных выбранного товара (попап);
- formErrors: FormErrors = {};

Конструктор: constructor() - конструктор наследуется от класса Model;

Методы:

- addBasket(item: ICardItem) - добавляет товар в корзину;
- productOrder(item: ICardItem): boolean - проверка, находится ли продукт в заказе;
- clearBasket() - очищает товары в корзине;
- updateBasket() - обновляет корзину;
- removeFromBasket(id: string) - удаляет товар из корзины;
- clearOrder() - очищает данные заказа;
- getOrderProducts(): ICardItem[] - получает продкуты из заказа;
- getTotalPrice(): number - возвращает общую цену товаров;
- setCatalog(item: ICardItem[]) - установить данные в каталог (вывести все наши продукты на страницу);
- setPreview(item: ICardItem) - установливает данные в первью;
- validateContact(): boolean - проверяет значения данных контактов;
- setContactField(field: keyof IOrderForm, value: string) - устанавливает значения в данные контактов заказа;
- validateOrder() - проверяет валидность полей формы заказа;
- setOrderField(item: keyof IOrderForm, value: string) - обновляет поле формы заказа, проверяет валидность заказа;

### Класс WebLarekAPI

Основной класс работы с API. Расширяется базовым классом Api.

Конструктор: (cdn: string, baseUrl: string, options?: RequestInit) принимает и передает в родительский конструктор baseUrl и options; записывает в поле api текущий URL

Класс использует интерфейсы IOrderResult и IAuctionAPI

IOrderResult

```
id: string;
total: number;
```

IAuctionAPI

```
getCardList: () => Promise<ICardItem[]>;
getCardItem: (id: string) => Promise<ICardItem>;
orderCards: (order: IOrder) => Promise<IOrderResult>;
```

Методы:

- getCardItem(id: string): Promise<ICardItem> - метод запроса элемента с сервера;
- getCardList(): Promise<ICardItem[]> - метод запроса списка товаров с сервера;
- orderCards(order: IOrder): Promise<IOrderResult> - метод отправки данных заказа на сервер;

## Описание классов представления (View)

Классы представления отвечают за отображение всех элементов страницы

### Класс Page

Класс отвечает за отображение страница в целом: каталога товаров, корзины;

Поля класса:

- counter - отвечает за счетчик корзины;
- catalog - отвечает за хранение разметки каталога карточек;
- wrapper - отвечает за хранение обертки страницы;
- basket - отвечает за хранение разметки кнопки корзины;

Конструктор: (container: HTMLElement, protected events: IEvents) в конструкторе устанавливается обработчик события для элемента корзины, который открывает окно с выбранными товарами;

Класс использует интерфейс IPage

```
counter: number;
catalog: HTMLElement[];
locked: boolean;
```

Методы:

- set counter(value: number) - отвечает за установку счетчика;
- set catalog(items: HTMLElement[]) - отвечает за установку каталога;
- set locked(value: boolean) - отвечает за не прокручивание страницы;

### Класс Card

Класс отвечает за отображение карточек товара, взятых из каталога; Наследуется от Component; использует данные ICardItem;

Поля класса:

- title - устанавливает название товара;
- image - устанавливает изображение карточки;
- category - устанавливает категорию товара и добавляет соответствующий класс к элементу категории;
- description - устанавливает описание карточки;
- price - устанавливает цену карточки и, если цена установлена, отключает кнопку карточки;
- button - устанавливает кнопку действия карточки;
- buttonModal - устанавливает кнопку модального окна;

Конструктор: (container: HTMLElement, actions?: ICardAction) принимает контейнер для карточки и объект действий. В конструкторе устанавливаются обработчики событий для категории, заголовка, описания, кнопки, стоимости

Класс использует интерфейсы ICard и ICardAction

ICard

```
title: string;
category: string;
image: string;
price: number;
text: string;
```

ICardAction

```
onClick(evt:MouseElement) => void;
```

Методы:

- disableButton(value: number | null) - отключение кнопки модального окна;
- set title(value: string) - устанавливает заголовок товара;
- set price(value: number | null) - проверяет на наличие цены;
- set description(value: string | string[]) - устанавливает описание карточки;
- set category(value: string) - кстанавливает категорию товара;

### Класс BasketElement

Класс отвечает за отображение товаров в корзине. Наследуется от Component

Поля класса:

- index - индекс элемента в корзине;
- title - заголовок элемента;
- price - цена элемента;
- button - кнопка действия элемента;

Конструктор: (container: HTMLElement, index: number, action?: ICardAction) конструктор принимает контейнер для элемента корзины, индекс элемента корзины и действие, выполняемое при клике на элемент корзины; в конструкторе присутствует обработчик события клика

Класс использует интерфейс IBasketItem

```
title: string;
price: number;
```

Методы:

- set index - отображает индекс элемента;
- set title - отображает заголовок элемента;
- set price - отображает цену элемента;

### Класс Modal

Класс отвечает за отображение модальных окон; Наследуется от Component

Поля класса:

- closeButton - хранение кнопки модального окна;
- content - хранение разметки контейнера модального окна;

Интерфейс класса - IModalData

```
content:HTMLElement;
```

Конструктор: (selector: string, events: IEvents) принимает селектор, в котором будет установленно модальное окно и экземпляр класса EventEmitter для возможности инициализации событий

Методы:

- open - открывает модальное окно;
- close - закрывает модальное окно;
- render - отображает модальное окно с контентом и открывает его;

### Класс Form

Класс создает формы, обрабатывает события ввода формы и отправки формы. Наследуется от Component

Поля класса:

- supbmit - разметка кнопки;
- errors - разметка ошибок в инпуте;

Интерфейс класса - IFormState

```
valid: boolean;
errors: string[];
```

Конструктор: (protected container: HTMLFormElement, protected events: IEvents) принимает селекторы полей форм, кнопки отправки форм и окна "заказ оформлен";

Методы:

- onInputChange - обрабатывает изменения ввода в поля формы;
- valid - валидация полей форм;
- errors - чистит правильно заполненную форму;
- render - находит ошибку;

### OrderAddress

Отвечает за отображение первого модального окна оплаты заказа Наследуется от Form. использует интерфейс IOrder.

Поля:

- card — хранит разметку кнопок формы оплаты;
- cash - хранит данные способов оплаты;
- address - хранит инпут поля адреса доставки;
- contactButton - контейнер с кнопками 'Онлайн' и 'При получении';

Конструктор: (container: HTMLFormElement, events: IEvents) принимает container:HTMLElement и объект event:IEvent
передает данные в родительский конструктор
сохраняет необходимые элементы разметки в полях
на кнопки выбора формы оплаты вешает слушатель click

Методы:

- PaymentMethod — устанавливает класс активности на кнопку;
- address — устанавливает значение поля адрес;
- resetButtonState - обновляет состояние кнопок формы;

### OrderContacts

Класс отвечает за второе модальное окно оплаты заказа. Наследуется от Form. Использует интерфейс IOrder

Поля:

- phoneInput - инпут поля для номера телефона;
- emailInput - иинпут поля для электронной почты;

Конструктор: (container: HTMLFormElement, events: IEvents) принимает container:HTMLElement и объект event:IEvent
передает данные в родительский конструктор

Методы:

- phone - устанавливает значение инпута телефона;
- email - устанавливает значение инпута почты;

### Класс Basket

Класс отвечает за отображение корзины товаров. Наследуется от Cmponent; использует интерфейс IBasketView

Поля класса:

- list - хранит в себе список товаров в корзине;
- total - хранит в себе сумму стоимости товаров;
- button - кнопка 'оформить';

IBasketView

```
items: HTMLElement[];
total: number;
```

Конструктор: (container: HTMLElement, protected events: EventEmitter) принимает корневой элемент корзины и объект событий, добавляет обработчик события на кнопку оформления заказа

Методы:

- items - добавляет товары в корзине;
- total - добавляет и отображает сумму товаров в корзине;

### Класс Success

Класс отображает за отображение модального окна успешного оформления заказа; наследуется от Component. Использует интерфейс ISuccess и ISuccessActions

Поля класса:

- close - разметка кнопки 'За новыми покупками!'
- total - разметка суммы товаров;

интерфейсы ISuccess и ISuccessActions

ISuccess

```
total:string | number;
```

ISuccessActions

```
onClick: () => void;
```

Конструктор: (container:HTMLElement и actions:ISuccessActions) принимает элемент успешной оплаты и устанавливает обработчик события для кнопки закрытия;

Методы:

- set total - устанавливает сообщение об успешной оплате;

## Взаимодействие компонентов (Presenter)

Код взаимодействия представления и данных между собой находится в файле index.ts, выполняет роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков событий, описанных в index.ts. В index.ts создаются экземпляры всех классов, далее настраивается обработка событий.

События взаимодействия, описанные в index.ts

- items:changed - изменение данных в каталоге;
- card:select - выбор товара;
- product:add - добавление товара в корзину;
- product:delete - выбор товара для удаления из корзины;
- basket:changed - изменение данных в корзине;
- preview:changed - выбор товара для предпросмотра продукта;
- basket:open - открытие корзины;
- order:open - открытие окна заказа;
- form:errors:change - валидация полей доставки;
- contacts:submit - оформление заказа;
- modal:open - открытие модального окна;
